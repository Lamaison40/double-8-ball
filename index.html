<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>Double Magic 8-Ball (Mobile Slot)</title>
<meta name="theme-color" content="#0c0f14" />
<style>
  :root{
    --bg:#0c0f14; --card:#111626; --ink:#e8ecf3; --muted:#9aa3b2;
    --accent:#6ad1ff; --accent2:#a57bff; --ok:#6bfa9c; --err:#ff8383;
    --ring: #1e2740;
  }
  *{box-sizing:border-box; -webkit-tap-highlight-color: transparent;}
  html,body{height:100%}
  body{
    margin:0; background: radial-gradient(1200px 700px at 50% -10%, #1b2030 0%, var(--bg) 65%);
    color:var(--ink); font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
  }
  .wrap{max-width:920px; margin:0 auto; padding:16px env(safe-area-inset-right) 22px env(safe-area-inset-left);}
  header{ text-align:center; margin:2px 0 6px;}
  h1{font-size: clamp(20px, 5.6vw, 28px); margin:0 0 6px;}
  .sub{color:var(--muted); margin:0 0 14px; font-size:14px}

  .row{display:grid; grid-template-columns:1fr; gap:14px;}
  @media (min-width: 820px){ .row{ grid-template-columns:1fr 1fr; gap:18px; } }

  .card{
    background: linear-gradient(180deg, #151a27 0%, #0f1320 100%);
    border:1px solid var(--ring); border-radius:18px; padding:14px;
    box-shadow: 0 30px 80px rgba(0,0,0,.35), inset 0 1px 0 rgba(255,255,255,.03);
  }
  .title{ display:flex; justify-content:space-between; align-items:center; margin-bottom:10px;}
  .title .label{ color:var(--muted); font-size:12px; letter-spacing:.3px; text-transform:uppercase}
  .title strong{ font-size:16px; letter-spacing:.3px}

  .ball{
    position:relative; width: min(78vw, 320px); height: min(78vw, 320px);
    margin: 0 auto 10px; border-radius:50%;
    background: radial-gradient(60% 60% at 35% 35%, #27304a 0%, #0a0d15 60%, #070a12 100%);
    border:1px solid #1b2340;
    box-shadow: inset 0 20px 60px rgba(255,255,255,.06), inset 0 -20px 60px rgba(0,0,0,.6), 0 20px 60px rgba(0,0,0,.45);
    display:flex; align-items:center; justify-content:center; overflow:hidden;
    touch-action: manipulation;
  }
  .window{
    width: 72%; height: 72%; background: radial-gradient(60% 60% at 50% 40%, #18213a 0%, #0c1225 60%, #0a0f1f 100%);
    border-radius:50%; border:1px solid #1a2445; display:flex; align-items:center; justify-content:center;
    box-shadow: inset 0 10px 40px rgba(0,0,0,.6), inset 0 -10px 30px rgba(0,0,0,.4);
  }
  .readout{
    text-align:center; font-weight:800; line-height:1.12; padding:12px 16px; border-radius:12px;
    background: linear-gradient(180deg, #0a1732 0%, #09132a 100%); border:1px solid #12244a;
    text-shadow: 0 0 14px rgba(106,209,255,.5);
    box-shadow: 0 8px 24px rgba(0,0,0,.35), inset 0 0 30px rgba(106,209,255,.08);
    min-width: 70%;
  }
  .readout .txt{ font-size: clamp(18px, 5.2vw, 28px); color: var(--ink); }

  .controls{ display:flex; gap:10px; justify-content:center; flex-wrap:wrap; }
  button{
    appearance:none; border:0; cursor:pointer; padding:12px 16px; border-radius:12px; font-weight:800;
    color:#0b1020; background:linear-gradient(180deg, #9fe0ff 0%, #6ad1ff 100%);
    box-shadow: 0 10px 20px rgba(0,0,0,.25); transition: transform .06s ease, filter .2s ease, opacity .2s ease;
    font-size:15px;
  }
  button:hover{ filter:brightness(1.05) }
  button:active{ transform: translateY(1px) scale(.99) }
  button.secondary{ background: linear-gradient(180deg, #c3b2ff 0%, #a57bff 100%); color:#0c0f14;}
  button.ghost{
    background: transparent; color: var(--ink); border:1px solid var(--ring);
  }
  button[disabled]{ opacity:.6; cursor:not-allowed; transform:none!important; }

  .both{ display:flex; justify-content:center; margin:12px auto 0;}
  .both button{ padding:14px 18px; font-size:16px }

  /* History */
  .history{
    margin-top:16px;
    background: linear-gradient(180deg, #0d1426 0%, #0a0f1f 100%);
    border:1px solid var(--ring); border-radius:16px; padding:10px;
  }
  .history h3{ margin:0 0 8px; font-size:14px; color:var(--muted); letter-spacing:.2px; text-transform:uppercase }
  .chips{ display:flex; flex-wrap:wrap; gap:8px; }
  .chip{
    display:inline-flex; align-items:center; gap:6px;
    background:#0f172a; border:1px solid #1f2a49; color:var(--ink);
    border-radius:999px; padding:8px 12px; font-size:13px;
    box-shadow: inset 0 1px 0 rgba(255,255,255,.03);
  }
  .chip .dot{ width:8px; height:8px; border-radius:50%; background:var(--accent); box-shadow:0 0 10px rgba(106,209,255,.8)}
  .hist-controls{ display:flex; gap:8px; margin-top:8px; justify-content:flex-end;}
  .empty{ color:var(--muted); font-size:13px; }

  /* Settings */
  .settings{
    margin-top:16px; padding:12px; border:1px dashed #2a3358; border-radius:14px; background:rgba(17,23,38,.45)
  }
  .settings h3{ margin:0 0 8px; font-size:14px; color:var(--muted); text-transform:uppercase; letter-spacing:.2px }
  .field{ display:grid; grid-template-columns: 100%; gap:8px; margin-bottom:10px;}
  .field label{ font-size:13px; color:var(--muted)}
  .field textarea{
    width:100%; min-height:56px; resize:vertical; padding:10px; border-radius:10px; border:1px solid #233058; background:#0f1426; color:var(--ink);
    font-family: ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,monospace; font-size:13px;
  }
  .setting-buttons{ display:flex; gap:8px; flex-wrap:wrap; }
  .note{ color:var(--muted); font-size:12px; margin-top:4px}

  /* Confetti canvas (fixed) */
  #confetti{ position:fixed; inset:0; pointer-events:none; z-index: 50; }
  .foot{ text-align:center; color:var(--muted); font-size:12px; margin-top:14px; }
</style>
</head>
<body>
<canvas id="confetti"></canvas>
<div class="wrap">
  <header>
    <h1>Double Magic 8-Ball</h1>
    <p class="sub">Spin each ball (or both). Uniformly random, slot-style animation, haptics, and confetti when both land.</p>
  </header>

  <div class="row">
    <!-- TIME BALL -->
    <section class="card" id="timeCard" aria-label="Time Ball">
      <div class="title"><div class="label">Ball A</div><strong>Time</strong></div>
      <div class="ball" id="timeBall" aria-live="polite">
        <div class="window"><div class="readout" id="timeReadout"><div class="txt">—</div></div></div>
      </div>
      <div class="controls">
        <button id="spinTime">SPIN TIME</button>
        <button class="secondary" id="resetTime">RESET</button>
      </div>
      <p class="sub" id="timeHint">Options: 30s, 1m, 2m, 3m</p>
    </section>

    <!-- PLACE BALL -->
    <section class="card" id="placeCard" aria-label="Place Ball">
      <div class="title"><div class="label">Ball B</div><strong>Location</strong></div>
      <div class="ball" id="placeBall" aria-live="polite">
        <div class="window"><div class="readout" id="placeReadout"><div class="txt">—</div></div></div>
      </div>
      <div class="controls">
        <button id="spinPlace">SPIN PLACE</button>
        <button class="secondary" id="resetPlace">RESET</button>
      </div>
      <p class="sub" id="placeHint">Options: Master bedroom, Front bedroom, Downstairs, Far bedroom</p>
    </section>
  </div>

  <!-- SPIN BOTH -->
  <div class="both"><button id="spinBoth">SPIN BOTH</button></div>

  <!-- HISTORY -->
  <section class="history card" id="historyCard" aria-live="polite" aria-label="History">
    <h3>Result History</h3>
    <div class="chips" id="historyChips"><div class="empty">No results yet.</div></div>
    <div class="hist-controls">
      <button class="ghost" id="copyHistory">Copy</button>
      <button class="ghost" id="clearHistory">Clear</button>
    </div>
  </section>

  <!-- SETTINGS -->
  <section class="settings" id="settings">
    <h3>Settings (Edit Options)</h3>
    <div class="field">
      <label for="timeOptions">Time options (comma-separated)</label>
      <textarea id="timeOptions" spellcheck="false">30s, 1m, 2m, 3m</textarea>
    </div>
    <div class="field">
      <label for="placeOptions">Location options (comma-separated)</label>
      <textarea id="placeOptions" spellcheck="false">Master bedroom, Front bedroom, Downstairs, Far bedroom</textarea>
    </div>
    <div class="setting-buttons">
      <button id="applySettings">Apply</button>
      <button class="secondary" id="resetDefaults">Reset to Defaults</button>
    </div>
    <div class="note">All options are given equal weight. Empty entries are ignored.</div>
  </section>

  <p class="foot">Tip: tap a ball to spin it. Press <strong>Space</strong> to spin both.</p>
</div>

<script>
/* =================== Config / Defaults =================== */
const DEFAULT_TIME  = ["30s","1m","2m","3m"];
const DEFAULT_PLACE = ["Master bedroom","Front bedroom","Downstairs","Far bedroom"];

// Animation parameters (slot feel; tweak if you like)
const MIN_CYCLES = 18, MAX_CYCLES = 32, START_IVL=70, END_IVL=340, EASING_STEPS=28;
function easeOutCubic(t){ return 1 - Math.pow(1 - t, 3); }

/* =================== Sound / Haptics =================== */
let audioCtx;
function blip(freq=520, duration=0.035){
  try{
    if (!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    const o = audioCtx.createOscillator();
    const g = audioCtx.createGain();
    o.type = 'square'; o.frequency.value = freq;
    g.gain.value = 0.0001;
    o.connect(g); g.connect(audioCtx.destination);
    const now = audioCtx.currentTime;
    g.gain.exponentialRampToValueAtTime(0.2, now + 0.005);
    g.gain.exponentialRampToValueAtTime(0.0001, now + duration);
    o.start(now); o.stop(now + duration);
  }catch(e){}
}
function thud(){ blip(160, 0.05); }
function tick(){ blip(420, 0.03); }
function haptic(ms=18){ if (navigator.vibrate) navigator.vibrate(ms); }

/* =================== Confetti =================== */
const confettiCanvas = document.getElementById('confetti');
const ctx = confettiCanvas.getContext('2d');
let confettiPieces = [], confettiActive = false, rafId = null;

function resizeCanvas(){
  confettiCanvas.width = window.innerWidth;
  confettiCanvas.height = window.innerHeight;
}
window.addEventListener('resize', resizeCanvas, {passive:true}); resizeCanvas();

function makeConfetti(count=220){
  const w = confettiCanvas.width, h = confettiCanvas.height;
  confettiPieces = [];
  for(let i=0;i<count;i++){
    confettiPieces.push({
      x: Math.random()*w, y: -10 - Math.random()*h*0.2,
      r: 2 + Math.random()*5, vy: 1 + Math.random()*3.5, vx: (Math.random()-0.5)*2.2,
      rot: Math.random()*Math.PI*2, vr: (Math.random()-0.5)*0.2,
      color: `hsl(${Math.floor(Math.random()*360)}, 90%, ${55+Math.random()*20}%)`
    });
  }
}
function drawConfetti(){
  const w = confettiCanvas.width, h = confettiCanvas.height;
  ctx.clearRect(0,0,w,h);
  for(const p of confettiPieces){
    ctx.save();
    ctx.translate(p.x, p.y); ctx.rotate(p.rot);
    ctx.fillStyle = p.color;
    ctx.fillRect(-p.r, -p.r, p.r*2, p.r*2);
    ctx.restore();
    p.y += p.vy; p.x += p.vx; p.rot += p.vr;
  }
  confettiPieces = confettiPieces.filter(p => p.y < h + 10);
  if (confettiPieces.length && confettiActive){
    rafId = requestAnimationFrame(drawConfetti);
  }else{
    confettiActive = false; cancelAnimationFrame(rafId);
    ctx.clearRect(0,0,w,h);
  }
}
function burstConfetti(){
  makeConfetti(); confettiActive = true; drawConfetti(); thud(); haptic(25);
}

/* =================== Spinner Class =================== */
class Spinner {
  constructor({options, readoutEl, buttonEl, ballEl}){
    this.options = options.slice();
    this.readoutEl = readoutEl;
    this.buttonEl = buttonEl;
    this.ballEl = ballEl;
    this.index = 0; this.spinning = false; this.timer = null;
    this.setText("—");
    // allow tapping the ball to spin
    if (this.ballEl) this.ballEl.addEventListener('click', () => this.spin());
  }
  setOptions(list){
    this.options = list.slice().filter(s => String(s).trim().length);
    if (!this.options.length) this.options = ["—"];
    this.index = 0; this.setText("—");
  }
  setText(t){ this.readoutEl.querySelector('.txt').textContent = t; }
  reset(){ if (this.timer) clearTimeout(this.timer); this.spinning=false; this.index=0; this.setText("—"); this.buttonEl.disabled=false; }
  spin(onFinish){
    if (this.spinning || this.options.length<1) return;
    this.spinning = true; this.buttonEl.disabled = true;
    const n = this.options.length;
    const target = Math.floor(Math.random() * n); // UNIFORM!
    const extraCycles = Math.floor(Math.random()*(MAX_CYCLES - MIN_CYCLES + 1)) + MIN_CYCLES;
    const totalSteps = extraCycles + ((target - this.index + n) % n);
    let steps=0;

    const step = () => {
      this.index = (this.index + 1) % n;
      this.setText(this.options[this.index]);
      steps++;
      tick(); // soft tick each step
      if (steps >= totalSteps){
        this.spinning = false; this.buttonEl.disabled=false;
        thud(); haptic(18);
        onFinish && onFinish(this.options[this.index]);
        return;
      }
      const t = Math.min(1, steps / Math.max(EASING_STEPS, totalSteps));
      const ivl = START_IVL + (END_IVL - START_IVL) * easeOutCubic(t);
      this.timer = setTimeout(step, ivl);
    };
    step();
  }
}

/* =================== App State =================== */
const els = {
  timeReadout: document.getElementById('timeReadout'),
  placeReadout: document.getElementById('placeReadout'),
  spinTime: document.getElementById('spinTime'),
  spinPlace: document.getElementById('spinPlace'),
  resetTime: document.getElementById('resetTime'),
  resetPlace: document.getElementById('resetPlace'),
  spinBoth: document.getElementById('spinBoth'),
  timeBall: document.getElementById('timeBall'),
  placeBall: document.getElementById('placeBall'),
  historyChips: document.getElementById('historyChips'),
  copyHistory: document.getElementById('copyHistory'),
  clearHistory: document.getElementById('clearHistory'),
  timeHint: document.getElementById('timeHint'),
  placeHint: document.getElementById('placeHint'),
  timeOptions: document.getElementById('timeOptions'),
  placeOptions: document.getElementById('placeOptions'),
  applySettings: document.getElementById('applySettings'),
  resetDefaults: document.getElementById('resetDefaults')
};

let TIME = DEFAULT_TIME.slice();
let PLACE = DEFAULT_PLACE.slice();
const history = []; const MAX_HISTORY = 24;

const timeSpinner = new Spinner({ options: TIME, readoutEl: els.timeReadout, buttonEl: els.spinTime, ballEl: els.timeBall });
const placeSpinner= new Spinner({ options: PLACE, readoutEl: els.placeReadout, buttonEl: els.spinPlace, ballEl: els.placeBall });

/* =================== UI Wiring =================== */
function updateHints(){
  els.timeHint.textContent = `Options: ${TIME.join(', ')}`;
  els.placeHint.textContent = `Options: ${PLACE.join(', ')}`;
}
function renderHistory(){
  const box = els.historyChips;
  box.innerHTML = '';
  if (!history.length){ box.innerHTML = '<div class="empty">No results yet.</div>'; return; }
  for (let i = history.length-1; i >= Math.max(0, history.length- MAX_HISTORY); i--){
    const item = history[i];
    const div = document.createElement('div'); div.className='chip';
    const dot = document.createElement('span'); dot.className='dot';
    const t = document.createElement('span'); t.textContent = item.time;
    const sep = document.createElement('span'); sep.textContent = '•';
    const p = document.createElement('span'); p.textContent = item.place;
    div.append(dot, t, sep, p);
    box.appendChild(div);
  }
}
function pushHistory(time, place){
  history.push({time, place, ts: Date.now()});
  if (history.length>500) history.shift();
  renderHistory();
}

let lastTime = null, lastPlace = null;
function maybeCelebrate(){
  if (lastTime && lastPlace){
    pushHistory(lastTime, lastPlace);
    burstConfetti();
    lastTime = lastPlace = null;
  }
}

/* Buttons */
els.spinTime.addEventListener('click', ()=> timeSpinner.spin(v => { lastTime = v; maybeCelebrate(); }));
els.spinPlace.addEventListener('click', ()=> placeSpinner.spin(v => { lastPlace = v; maybeCelebrate(); }));
els.resetTime.addEventListener('click', ()=> timeSpinner.reset());
els.resetPlace.addEventListener('click', ()=> placeSpinner.reset());
els.spinBoth.addEventListener('click', ()=>{
  timeSpinner.spin(v => { lastTime = v; maybeCelebrate(); });
  setTimeout(()=> placeSpinner.spin(v => { lastPlace = v; maybeCelebrate(); }), 180);
});

/* Keyboard */
window.addEventListener('keydown', (e)=>{ if (e.code==='Space'){ e.preventDefault(); els.spinBoth.click(); }});

/* History actions */
els.clearHistory.addEventListener('click', ()=> { history.length = 0; renderHistory(); haptic(12); });
els.copyHistory.addEventListener('click', async ()=>{
  const lines = history.map(h => `${new Date(h.ts).toLocaleString()}: ${h.time} — ${h.place}`);
  try{ await navigator.clipboard.writeText(lines.join('\n')); toast('Copied history'); haptic(8);}catch(e){ toast('Copy failed', true); }
});
function toast(msg, isErr=false){
  const t = document.createElement('div');
  t.textContent = msg;
  t.style.cssText = `position:fixed; left:50%; bottom:calc(16px + env(safe-area-inset-bottom)); transform:translateX(-50%);
    background:${isErr?'#3a0d16':'#0d2a1a'}; color:${isErr?'#ffd6dd':'#ccffde'}; border:1px solid ${isErr?'#5d1c2c':'#164d2e'};
    padding:10px 14px; border-radius:12px; font-size:13px; z-index:60; box-shadow:0 10px 24px rgba(0,0,0,.35);`;
  document.body.appendChild(t); setTimeout(()=>{ t.remove(); }, 1400);
}

/* Settings */
function parseCSV(str){
  return String(str||'').split(',').map(s => s.trim()).filter(Boolean);
}
function applySettingsFromFields(){
  const t = parseCSV(els.timeOptions.value);
  const p = parseCSV(els.placeOptions.value);
  if (!t.length || !p.length){ toast('Lists can’t be empty', true); thud(); return; }
  TIME = t; PLACE = p;
  timeSpinner.setOptions(TIME); placeSpinner.setOptions(PLACE);
  updateHints(); haptic(10); toast('Options updated');
}
function resetDefaults(){
  TIME = DEFAULT_TIME.slice(); PLACE = DEFAULT_PLACE.slice();
  els.timeOptions.value = DEFAULT_TIME.join(', ');
  els.placeOptions.value = DEFAULT_PLACE.join(', ');
  timeSpinner.setOptions(TIME); placeSpinner.setOptions(PLACE);
  updateHints(); toast('Defaults restored');
}
els.applySettings.addEventListener('click', applySettingsFromFields);
els.resetDefaults.addEventListener('click', resetDefaults);

/* Init */
(function init(){
  els.timeReadout.querySelector('.txt').textContent = TIME[0];
  els.placeReadout.querySelector('.txt').textContent = PLACE[0];
  updateHints(); renderHistory();
})();
</script>
</body>
</html>
